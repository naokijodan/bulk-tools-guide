<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>シッピングポリシー計算ツール | 一括シートV3</title>
    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #1557b0;
            --success: #34a853;
            --warning: #ea8600;
            --danger: #d93025;
            --bg: #f8f9fa;
            --card-bg: #ffffff;
            --text: #202124;
            --text-secondary: #5f6368;
            --border: #dadce0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: var(--primary);
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1em;
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 24px;
            margin-bottom: 20px;
        }

        .card h2 {
            color: var(--primary);
            font-size: 1.2em;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary);
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--text);
        }

        .hint {
            font-size: 0.85em;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        input[type="number"], select {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            transition: border-color 0.2s;
        }

        input[type="number"]:focus, select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .input-with-unit {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-with-unit input {
            flex: 1;
        }

        .unit {
            font-weight: 600;
            color: var(--text-secondary);
            min-width: 30px;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        @media (max-width: 600px) {
            .input-row {
                grid-template-columns: 1fr;
            }
        }

        .result-box {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border: 3px solid var(--success);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
        }

        .result-label {
            font-size: 1em;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .result-value {
            font-size: 1.1em;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 8px;
            word-break: break-all;
            font-family: 'Courier New', monospace;
        }

        .result-detail {
            font-size: 0.95em;
            color: var(--text-secondary);
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(0,0,0,0.1);
        }

        .copy-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            margin-top: 12px;
            transition: background 0.2s;
        }

        .copy-btn:hover {
            background: var(--primary-dark);
        }

        .copy-btn.copied {
            background: var(--success);
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid var(--primary);
            padding: 16px;
            border-radius: 0 8px 8px 0;
            margin-top: 20px;
        }

        .info-box h3 {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 1em;
        }

        .info-box p, .info-box li {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .info-box ul {
            margin-left: 20px;
            margin-top: 8px;
        }

        .warning-box {
            background: #fff3e0;
            border-left: 4px solid var(--warning);
            padding: 16px;
            border-radius: 0 8px 8px 0;
            margin-top: 20px;
        }

        .warning-box h3 {
            color: var(--warning);
            margin-bottom: 8px;
            font-size: 1em;
        }

        .calc-steps {
            background: #f5f5f5;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            font-size: 0.9em;
        }

        .calc-steps h4 {
            color: var(--text);
            margin-bottom: 12px;
        }

        .calc-step {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .calc-step:last-child {
            border-bottom: none;
            font-weight: 600;
            color: var(--primary);
        }

        .calc-step .label {
            color: var(--text-secondary);
        }

        .calc-step .value {
            font-weight: 500;
        }

        .shipping-method-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-top: 8px;
        }

        .badge-eco {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .badge-xp {
            background: #e3f2fd;
            color: #1565c0;
        }

        .badge-over {
            background: #ffebee;
            color: #c62828;
        }

        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        footer a {
            color: var(--primary);
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 8px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: normal;
            cursor: pointer;
        }

        .radio-group input[type="radio"] {
            width: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>シッピングポリシー計算ツール</h1>
            <p class="subtitle">既存出品のポリシーを確認・更新</p>
        </header>

        <div class="card">
            <h2>入力</h2>

            <div class="input-row">
                <div class="form-group">
                    <label for="sellingPrice">販売価格</label>
                    <div class="input-with-unit">
                        <input type="number" id="sellingPrice" value="50" step="0.01">
                        <span class="unit">$</span>
                    </div>
                    <p class="hint">eBayでの販売価格（関税抜き）</p>
                </div>

                <div class="form-group">
                    <label for="tariffRate">関税率</label>
                    <div class="input-with-unit">
                        <input type="number" id="tariffRate" value="15" step="0.1">
                        <span class="unit">%</span>
                    </div>
                    <p class="hint">商品カテゴリーの関税率</p>
                </div>
            </div>

            <div class="input-row">
                <div class="form-group">
                    <label for="feeRate">eBay手数料率</label>
                    <div class="input-with-unit">
                        <input type="number" id="feeRate" value="15" step="0.1">
                        <span class="unit">%</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="adRate">広告費率</label>
                    <div class="input-with-unit">
                        <input type="number" id="adRate" value="5" step="0.1">
                        <span class="unit">%</span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>商品状態</label>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="condition" value="new" checked>
                        新品 (new)
                    </label>
                    <label>
                        <input type="radio" name="condition" value="used">
                        中古 (used)
                    </label>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>計算結果</h2>

            <div class="result-box">
                <div class="result-label">推奨シッピングポリシー</div>
                <div class="result-value" id="recommendedPolicy">-</div>
                <div id="shippingBadge"></div>
                <div class="result-detail">
                    DDP価格: <strong id="ddpPrice">-</strong> ｜
                    関税額: <strong id="estimatedTariff">-</strong>
                </div>
                <button class="copy-btn" id="copyBtn" onclick="copyResult()">ポリシー名をコピー</button>
            </div>

            <div class="calc-steps">
                <h4>計算内訳</h4>
                <div class="calc-step">
                    <span class="label">販売価格</span>
                    <span class="value" id="stepSellingPrice">$50.00</span>
                </div>
                <div class="calc-step">
                    <span class="label">調整関税率</span>
                    <span class="value" id="stepAdjustedRate">19.5%</span>
                </div>
                <div class="calc-step">
                    <span class="label">関税額（四捨五入）</span>
                    <span class="value" id="stepTariff">$10</span>
                </div>
                <div class="calc-step">
                    <span class="label">DDP価格（販売価格＋関税）</span>
                    <span class="value" id="stepDDP">$60</span>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>使い方</h2>

            <div class="info-box">
                <h3>このツールについて</h3>
                <p>V3の調整関税率方式で、シッピングポリシー名を確認するツールです。</p>
                <ul>
                    <li>ECO（Economy）: DDP価格 $0〜$440 に対応</li>
                    <li>XP（Express）: DDP価格 $0〜$2519 に対応</li>
                    <li>DDP価格が$440以下なら ECO、それ以上なら XP が選択されます</li>
                </ul>
            </div>

            <div class="warning-box">
                <h3>注意事項</h3>
                <p>このツールは参考値です。実際のポリシー適用は一括シートV3の機能をご利用ください。</p>
            </div>
        </div>

        <footer>
            <p>
                <a href="ver44-update.html">&larr; V3 更新内容に戻る</a>
            </p>
            <p style="margin-top: 10px;">
                一括シートV3 | シッピングポリシー計算ツール
            </p>
        </footer>
    </div>

    <script>
        // ECOポリシーデータ（DDP下限-上限、関税額）
        const ecoPolicies = [
            { min: 0, max: 7, tariff: 3 },
            { min: 7, max: 13, tariff: 4 },
            { min: 13, max: 20, tariff: 5 },
            { min: 20, max: 26, tariff: 6 },
            { min: 26, max: 33, tariff: 7 },
            { min: 33, max: 40, tariff: 8 },
            { min: 40, max: 46, tariff: 9 },
            { min: 46, max: 52, tariff: 10 },
            { min: 52, max: 59, tariff: 11 },
            { min: 59, max: 65, tariff: 12 },
            { min: 65, max: 72, tariff: 13 },
            { min: 72, max: 78, tariff: 14 },
            { min: 78, max: 85, tariff: 15 },
            { min: 85, max: 91, tariff: 16 },
            { min: 91, max: 97, tariff: 17 },
            { min: 97, max: 104, tariff: 18 },
            { min: 104, max: 110, tariff: 19 },
            { min: 110, max: 117, tariff: 20 },
            { min: 117, max: 130, tariff: 22 },
            { min: 130, max: 143, tariff: 24 },
            { min: 143, max: 150, tariff: 25 },
            { min: 150, max: 156, tariff: 26 },
            { min: 156, max: 169, tariff: 28 },
            { min: 169, max: 181, tariff: 30 },
            { min: 181, max: 194, tariff: 32 },
            { min: 194, max: 207, tariff: 34 },
            { min: 207, max: 214, tariff: 35 },
            { min: 214, max: 227, tariff: 37 },
            { min: 227, max: 246, tariff: 40 },
            { min: 246, max: 259, tariff: 42 },
            { min: 259, max: 278, tariff: 45 },
            { min: 278, max: 291, tariff: 47 },
            { min: 291, max: 311, tariff: 50 },
            { min: 311, max: 324, tariff: 52 },
            { min: 324, max: 343, tariff: 55 },
            { min: 343, max: 356, tariff: 57 },
            { min: 356, max: 375, tariff: 60 },
            { min: 375, max: 407, tariff: 65 },
            { min: 407, max: 440, tariff: 70 }
        ];

        // XPポリシーデータ（DDP下限-上限、関税額）
        const xpPolicies = [
            { min: 0, max: 45, tariff: 7 },
            { min: 45, max: 52, tariff: 8 },
            { min: 52, max: 58, tariff: 9 },
            { min: 58, max: 65, tariff: 10 },
            { min: 65, max: 71, tariff: 11 },
            { min: 71, max: 78, tariff: 12 },
            { min: 78, max: 84, tariff: 13 },
            { min: 84, max: 90, tariff: 14 },
            { min: 90, max: 97, tariff: 15 },
            { min: 97, max: 103, tariff: 16 },
            { min: 103, max: 110, tariff: 17 },
            { min: 110, max: 116, tariff: 18 },
            { min: 116, max: 123, tariff: 19 },
            { min: 123, max: 129, tariff: 20 },
            { min: 129, max: 142, tariff: 22 },
            { min: 142, max: 155, tariff: 24 },
            { min: 155, max: 161, tariff: 25 },
            { min: 161, max: 168, tariff: 26 },
            { min: 168, max: 181, tariff: 28 },
            { min: 181, max: 194, tariff: 30 },
            { min: 194, max: 207, tariff: 32 },
            { min: 207, max: 220, tariff: 34 },
            { min: 220, max: 226, tariff: 35 },
            { min: 226, max: 239, tariff: 37 },
            { min: 239, max: 258, tariff: 40 },
            { min: 258, max: 271, tariff: 42 },
            { min: 271, max: 291, tariff: 45 },
            { min: 291, max: 304, tariff: 47 },
            { min: 304, max: 323, tariff: 50 },
            { min: 323, max: 336, tariff: 52 },
            { min: 336, max: 355, tariff: 55 },
            { min: 355, max: 368, tariff: 57 },
            { min: 368, max: 388, tariff: 60 },
            { min: 388, max: 420, tariff: 65 },
            { min: 420, max: 452, tariff: 70 },
            { min: 452, max: 484, tariff: 75 },
            { min: 484, max: 517, tariff: 80 },
            { min: 517, max: 549, tariff: 85 },
            { min: 549, max: 581, tariff: 90 },
            { min: 581, max: 614, tariff: 95 },
            { min: 614, max: 646, tariff: 100 },
            { min: 646, max: 678, tariff: 105 },
            { min: 678, max: 710, tariff: 110 },
            { min: 710, max: 743, tariff: 115 },
            { min: 743, max: 775, tariff: 120 },
            { min: 775, max: 807, tariff: 125 },
            { min: 807, max: 840, tariff: 130 },
            { min: 840, max: 872, tariff: 135 },
            { min: 872, max: 904, tariff: 140 },
            { min: 904, max: 937, tariff: 145 },
            { min: 937, max: 969, tariff: 150 },
            { min: 969, max: 1001, tariff: 155 },
            { min: 1001, max: 1033, tariff: 160 },
            { min: 1033, max: 1066, tariff: 165 },
            { min: 1066, max: 1098, tariff: 170 },
            { min: 1098, max: 1130, tariff: 175 },
            { min: 1130, max: 1163, tariff: 180 },
            { min: 1163, max: 1195, tariff: 185 },
            { min: 1195, max: 1227, tariff: 190 },
            { min: 1227, max: 1259, tariff: 195 },
            { min: 1259, max: 1292, tariff: 200 },
            { min: 1292, max: 1324, tariff: 205 },
            { min: 1324, max: 1356, tariff: 210 },
            { min: 1356, max: 1389, tariff: 215 },
            { min: 1389, max: 1421, tariff: 220 },
            { min: 1421, max: 1453, tariff: 225 },
            { min: 1453, max: 1486, tariff: 230 },
            { min: 1486, max: 1518, tariff: 235 },
            { min: 1518, max: 1550, tariff: 240 },
            { min: 1550, max: 1582, tariff: 245 },
            { min: 1582, max: 1615, tariff: 250 },
            { min: 1615, max: 1647, tariff: 255 },
            { min: 1647, max: 1679, tariff: 260 },
            { min: 1679, max: 1712, tariff: 265 },
            { min: 1712, max: 1744, tariff: 270 },
            { min: 1744, max: 1776, tariff: 275 },
            { min: 1776, max: 1808, tariff: 280 },
            { min: 1808, max: 1841, tariff: 285 },
            { min: 1841, max: 1873, tariff: 290 },
            { min: 1873, max: 1905, tariff: 295 },
            { min: 1905, max: 1938, tariff: 300 },
            { min: 1938, max: 1970, tariff: 305 },
            { min: 1970, max: 2002, tariff: 310 },
            { min: 2002, max: 2034, tariff: 315 },
            { min: 2034, max: 2067, tariff: 320 },
            { min: 2067, max: 2099, tariff: 325 },
            { min: 2099, max: 2131, tariff: 330 },
            { min: 2131, max: 2164, tariff: 335 },
            { min: 2164, max: 2196, tariff: 340 },
            { min: 2196, max: 2228, tariff: 345 },
            { min: 2228, max: 2261, tariff: 350 },
            { min: 2261, max: 2293, tariff: 355 },
            { min: 2293, max: 2325, tariff: 360 },
            { min: 2325, max: 2357, tariff: 365 },
            { min: 2357, max: 2390, tariff: 370 },
            { min: 2390, max: 2422, tariff: 375 },
            { min: 2422, max: 2454, tariff: 380 },
            { min: 2454, max: 2487, tariff: 385 },
            { min: 2487, max: 2519, tariff: 390 }
        ];

        // 入力要素
        const sellingPriceInput = document.getElementById('sellingPrice');
        const tariffRateInput = document.getElementById('tariffRate');
        const feeRateInput = document.getElementById('feeRate');
        const adRateInput = document.getElementById('adRate');

        // 結果表示要素
        const recommendedPolicyEl = document.getElementById('recommendedPolicy');
        const ddpPriceEl = document.getElementById('ddpPrice');
        const estimatedTariffEl = document.getElementById('estimatedTariff');
        const shippingBadgeEl = document.getElementById('shippingBadge');
        const stepSellingPriceEl = document.getElementById('stepSellingPrice');
        const stepAdjustedRateEl = document.getElementById('stepAdjustedRate');
        const stepTariffEl = document.getElementById('stepTariff');
        const stepDDPEl = document.getElementById('stepDDP');

        // ポリシー名を生成
        function generatePolicyName(policy, shippingMethod, condition) {
            const minStr = String(policy.min).padStart(4, '0');
            const maxStr = String(policy.max).padStart(4, '0');
            const tariffStr = String(policy.tariff).padStart(4, '0');
            return `Egl_2511-${minStr}-${maxStr}_${shippingMethod}_${condition}_${tariffStr}`;
        }

        // 計算関数
        function calculate() {
            const sellingPrice = parseFloat(sellingPriceInput.value) || 0;
            const tariffRate = parseFloat(tariffRateInput.value) / 100 || 0;
            const feeRate = parseFloat(feeRateInput.value) / 100 || 0;
            const adRate = parseFloat(adRateInput.value) / 100 || 0;
            const condition = document.querySelector('input[name="condition"]:checked').value;

            // 調整関税率を計算
            const denominator = 1 - feeRate - adRate;
            let adjustedRate = 0;
            if (denominator > 0) {
                adjustedRate = (tariffRate / denominator) * 1.03; // 3%の安全係数
            }

            // 関税額を計算（四捨五入して整数に）
            const estimatedTariff = Math.round(sellingPrice * adjustedRate);

            // DDP価格を計算（整数）
            const ddpPrice = Math.round(sellingPrice + estimatedTariff);

            // ポリシーを判定
            let recommendedPolicy = '-';
            let shippingMethod = '';
            let foundPolicy = null;

            // まずECOで探す（DDP $440以下）
            if (ddpPrice <= 440) {
                for (const policy of ecoPolicies) {
                    if (ddpPrice >= policy.min && ddpPrice < policy.max) {
                        foundPolicy = policy;
                        shippingMethod = 'eco';
                        break;
                    }
                }
            }

            // ECOで見つからない、またはDDP > 440の場合はXPで探す
            if (!foundPolicy && ddpPrice <= 2519) {
                for (const policy of xpPolicies) {
                    if (ddpPrice >= policy.min && ddpPrice < policy.max) {
                        foundPolicy = policy;
                        shippingMethod = 'xp';
                        break;
                    }
                }
            }

            if (foundPolicy) {
                recommendedPolicy = generatePolicyName(foundPolicy, shippingMethod, condition);
            } else if (ddpPrice > 2519) {
                recommendedPolicy = '対応範囲外（DDP $2519超）';
                shippingMethod = 'over';
            }

            // 表示更新
            recommendedPolicyEl.textContent = recommendedPolicy;
            ddpPriceEl.textContent = '$' + ddpPrice;
            estimatedTariffEl.textContent = '$' + estimatedTariff;

            // バッジ表示
            if (shippingMethod === 'eco') {
                shippingBadgeEl.innerHTML = '<span class="shipping-method-badge badge-eco">ECO（Economy）</span>';
            } else if (shippingMethod === 'xp') {
                shippingBadgeEl.innerHTML = '<span class="shipping-method-badge badge-xp">XP（Express）</span>';
            } else if (shippingMethod === 'over') {
                shippingBadgeEl.innerHTML = '<span class="shipping-method-badge badge-over">範囲外</span>';
            } else {
                shippingBadgeEl.innerHTML = '';
            }

            stepSellingPriceEl.textContent = '$' + sellingPrice.toFixed(2);
            stepAdjustedRateEl.textContent = (adjustedRate * 100).toFixed(1) + '%';
            stepTariffEl.textContent = '$' + estimatedTariff;
            stepDDPEl.textContent = '$' + ddpPrice;
        }

        // コピー機能
        function copyResult() {
            const policyName = recommendedPolicyEl.textContent;
            if (policyName === '-' || policyName.includes('対応範囲外')) return;

            navigator.clipboard.writeText(policyName).then(() => {
                const btn = document.getElementById('copyBtn');
                btn.textContent = 'コピーしました！';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'ポリシー名をコピー';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        // イベントリスナー
        [sellingPriceInput, tariffRateInput, feeRateInput, adRateInput].forEach(input => {
            input.addEventListener('input', calculate);
            input.addEventListener('change', calculate);
        });

        document.querySelectorAll('input[name="condition"]').forEach(radio => {
            radio.addEventListener('change', calculate);
        });

        // 初期計算
        calculate();
    </script>
</body>
</html>
